{
    "contents" : "#data input script\n#reads climate data, truncates to 101 years, and imputes missing values\n\n#clear all variables\nrm(list=ls())\n\n#libraries\nlibrary(timeDate)\nlibrary(Amelia)\n\n#Set appropriate working directory\nif(Sys.getenv(\"USERNAME\")==\"Collin\" || Sys.getenv(\"USERNAME\")==\"collin\"){ #If it's collin\n  if(Sys.info()[1]==\"Linux\"){\n    setwd(\"/home/collin/Dropbox/Grad school/research projects/yang_cue\")\n  }else{\n    setwd(\"C:\\\\Repos\\\\phenology-cues\") #desktop\n  }\n}else{\n  if(Sys.getenv(\"COMPUTERNAME\")==\"ENT-YANG01\"){\n    setwd(\"C:\\\\Users\\\\lhyang.ent-yang01\\\\SkyDrive\\\\Phenology simulation\\\\phenology-cues\")#desktop\n  }else{  \n    setwd(\"C:\\\\Users\\\\lhyang\\\\Skydrive\\\\Phenology simulation\\\\phenology-cues\")} #laptop\n}\n\n#input data\ndavis.daily<-read.csv(\"davis-data/626713.csv\", header=T, na.strings=\"-9999\")\ndavis.daily$YEAR<-as.numeric(substr(davis.daily$DATE,1,4)) #simple field for year\ndavis.daily<-davis.daily[davis.daily$YEAR>1913 & davis.daily$YEAR<2015,] #truncates the data to 101 complete years between 1914 and 2014\n\ndavis.daily$PRCP<-davis.daily$PRCP/10 #precips are reported in tenths of mm\ndavis.daily$TMAX<-davis.daily$TMAX/10 #temps are reported in tenths of degree C\ndavis.daily$TMIN<-davis.daily$TMIN/10 #temps are reported in tenths of degree C\ndavis.daily$DATE2<-as.Date(as.character(davis.daily$DATE),format=\"%Y %m %d\") #DATE2 is date formatted\ndavis.daily$JULIAN<-julian(davis.daily$DATE2,origin=as.Date(\"1913-12-31\")) #1914-01-01 is day 1\ndavis.daily$MONTH<-as.numeric(substr(davis.daily$DATE,5,6)) #simple field for month\ndavis.daily$DAY<-as.numeric(substr(davis.daily$DATE,7,8)) #simple field for day\ndavis.daily<-davis.daily[,c(\"DATE2\",\"JULIAN\", \"YEAR\",\"MONTH\",\"DAY\",\"PRCP\",\"TMAX\",\"TMIN\")] #simplified dataframe\n\ndavis.yearlist<-split(davis.daily,davis.daily$YEAR) #list of each year separated\n\ndavis.yearnames<-unique(davis.daily$YEAR) #gives a list of all the years in the data\n\n#calculates the \"day of year\", i.e. Jan 1 is 1, and 12/31 is 365 \n#adds a DAY.OF.YEAR column to each dataframe in the year list\nfor (i in 1:length(davis.yearnames)){\n  davis.yearlist[[i]]$DAY.OF.YEAR<-julian(davis.yearlist[[i]]$DATE2, origin=as.Date(paste(davis.yearnames[i],\"01\",\"01\",sep=\"-\")))+1 #add +1 so that the first day of the year is 1, not zero. \n}\n\ndavis.daily<-unsplit(davis.yearlist,davis.daily$YEAR)\ndavis.daily.means<-aggregate(cbind(TMAX,TMIN,PRCP)~DAY.OF.YEAR, data=davis.daily, mean)\n\ndavis.yearvar<-data.frame(row.names=davis.yearnames) #dataframe to hold environmental variability\n\nfor (i in 1:length(davis.yearnames)){\n  #temporary dataframe to compare with mean conditions\n  #this creates a VAR.x for each year and a VAR.y for the daily means\n  comparison<-merge(davis.yearlist[[i]],davis.daily.means,by=\"DAY.OF.YEAR\") \n  #number of complete cases (is.na=F) for each year\n  davis.yearvar[i,\"TMAX.N\"]<-sum(complete.cases(davis.yearlist[[i]]$TMAX))\n  davis.yearvar[i,\"TMIN.N\"]<-sum(complete.cases(davis.yearlist[[i]]$TMIN))\n  davis.yearvar[i,\"PRCP.N\"]<-sum(complete.cases(davis.yearlist[[i]]$PRCP))\n  #sum of squared differences with an average year - how weird is each year?\n  #some years have incomplete data, so this is the mean SS per observed day\n  davis.yearvar[i,\"TMAX.SS\"]<-(sum(comparison$TMAX.x-comparison$TMAX.y,na.rm=T)^2)/davis.yearvar[i,\"TMAX.N\"]\n  davis.yearvar[i,\"TMIN.SS\"]<-(sum(comparison$TMIN.x-comparison$TMIN.y,na.rm=T)^2)/davis.yearvar[i,\"TMIN.N\"]\n  davis.yearvar[i,\"PRCP.SS\"]<-(sum(comparison$PRCP.x-comparison$PRCP.y,na.rm=T)^2)/davis.yearvar[i,\"PRCP.N\"]\n  #CV within years - how variable is each year?\n  davis.yearvar[i,\"TMAX.CV\"]<-sd(comparison$TMAX.x,na.rm=T)/mean(comparison$TMAX.x,na.rm=T)\n  davis.yearvar[i,\"TMIN.CV\"]<-sd(comparison$TMIN.x,na.rm=T)/mean(comparison$TMIN.x,na.rm=T)\n  davis.yearvar[i,\"PRCP.CV\"]<-sd(comparison$PRCP.x,na.rm=T)/mean(comparison$PRCP.x,na.rm=T)\n  #sum of differences (not squared) with an average year - how hot/wet is each year?\n  #some years have incomplete data, so this is the mean difference per observed day\n  davis.yearvar[i,\"TMAX.DEL\"]<-sum(comparison$TMAX.x-comparison$TMAX.y,na.rm=T)/davis.yearvar[i,\"TMAX.N\"]\n  davis.yearvar[i,\"TMIN.DEL\"]<-sum(comparison$TMIN.x-comparison$TMIN.y,na.rm=T)/davis.yearvar[i,\"TMIN.N\"]\n  davis.yearvar[i,\"PRCP.DEL\"]<-sum(comparison$PRCP.x-comparison$PRCP.y,na.rm=T)/davis.yearvar[i,\"PRCP.N\"]\n}\n\n#temporary plots checking that the data are mostly complete\nplot(davis.daily$JULIAN,davis.daily$TMAX) \nplot(davis.daily$JULIAN,is.na(davis.daily$TMAX))\n#however, there are 143 missing rows\nmax(davis.daily$JULIAN)-length(davis.daily$JULIAN)\nmatch(seq(1:max(davis.daily$JULIAN)),davis.daily$JULIAN)\n\n\n\n\n#amelia scripting in progress\namelia(davis.daily,m=5,idvars=c(\"DATE2\",\"JULIAN\",)\n\n",
    "created" : 1449255287843.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "333834036",
    "id" : "CAEB8909",
    "lastKnownWriteTime" : 1449279427,
    "path" : "C:/Users/lhyang/SkyDrive/Phenology simulation/phenology-cues/data_input.R",
    "project_path" : "data_input.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}